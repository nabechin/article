{% load static %}
<!DOCTYPE html>
<html lang="ja">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
  integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<head>
  <meta name="generator" content="Jekyll v3.8.5" />
  <meta property="og:title" content="Layout" />
  <meta property="og:locale" content="en_US" />
  <meta name="description" content="AdminLTE v3 Documentaion" />
  <meta property="og:description" content="AdminLTE v3 Documentaion" />
  <meta property="og:site_name" content="AdminLTE v3 Documentaion" />
  <link rel="stylesheet" href="{% static 'admin-lte/plugins/fontawesome-free/css/all.min.css' %}">
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" type="text/css" href="{% static 'admin-lte/dist/css/adminlte.min.css' %}">
  <link rel="stylesheet" type="text/css"
    href="{% static 'admin-lte/plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <script src="{% static 'admin-lte/plugins/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'admin-lte/plugins/jquery-ui/jquery-ui.min.js' %}"></script>
  <script src="{% static 'admin-lte/plugins/bootstrap/js/bootstrap.bundle.min.js' %} "></script>
  <script src="{% static 'admin-lte/dist/js/adminlte.min.js' %}"></script>
  <script src="{% static 'admin-lte/dist/js/demo.js' %}"></script>
  <script src="{% static 'js/content.js' %}"></script>
  <script src="{% static 'js/base_ajax.js' %}"></script>
  <script>
    $(function () {
      /* プロフィール画像のアクション発火(click、pointer) */
      $('.following_profile_image').hover(function () {
        $(this).css('cursor', 'pointer');
        $(this).css('opacity', '0.7');
      });
      $('.following_profile_image').mouseout(function () {
        $(this).css('opacity', '1');
      });
      // is_follow -> 0 フォローボタン表示　is_follow -> 1 フォロー中ボタン表示
      var is_follow = $('.judge_relation').val()
      if (is_follow == 0) {
        $('.un-follow').css('display', 'block')
      }
      if (is_follow == 1) {
        $('.already-follow').css('display', 'block')
      }

      /* フォローのリクエストをajax通信でpostした後の処理
    　   「フォローする」-> 「フォロー中」にボタンを変更
    　　  後にフォロー解除ができるように、relationIdを埋め込む */
      var afterSuccessFollow = function ($unfollowButtonElement, target) {
        return function (data) {
          $unfollowButtonElement.text('フォロー中')
          $unfollowButtonElement.removeClass('un-follow').addClass('already-follow')
          $unfollowButtonElement.removeClass('btn-outline-primary').addClass('bg-gradient-primary')
          relationId = data['id']
          if (relationId) {
            $('#' + target).val(data['id']);
          }
        }
      };

      /* フォロー解除をdeleteメソッドでリクエストをした後の処理
        「フォロー中」-> 「フォローする」にボタンを変更 */
      var afterSuccessUnfollow = function ($alreadyfollowButtonElement, target) {
        $alreadyfollowButtonElement.text('フォローする')
        $alreadyfollowButtonElement.removeClass('already-follow').addClass('un-follow')
        $alreadyfollowButtonElement.removeClass('bg-gradient-primary').addClass('btn-outline-primary')
      };

      /* 「フォローする」ボタンを押した後の処理
          フォローのリクエストをajax通信でpostする処理 */
      $('body').on('click', '.un-follow', function () {
        var $unfollowButtonElement = $(this)
        var target = $unfollowButtonElement.next().attr('id');
        var data = new FormData();
        data.append('target', target);
        $.ajax({
          url: 'http://localhost/api/relation/',
          type: 'POST',
          dataType: 'json',
          data: data,
          success: afterSuccessFollow($unfollowButtonElement, target),
          processData: false,
          contentType: false,
        })
      });

      /* 「フォロー」タンを押した後の処理
          フォロー解除をdeleteメソッドでリクエストする */
      $('body').on('click', '.already-follow', function () {
        var $alreadyfollowButtonElement = $(this)
        var target = $alreadyfollowButtonElement.next().val();
        $.ajax({
          url: 'http://localhost/api/relation/' + target + '/',
          type: 'DELETE',
          success: afterSuccessUnfollow($alreadyfollowButtonElement),
          processData: false,
          contentType: false,
        })
      });
    });
  </script>
</head>

<body>
  {% csrf_token %}
  <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #e3f2fd;">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
      </ul>
      <a class="nav-link text-dark" href="{% url 'account:login' %}" tabindex="-1" aria-disabled="true">ログイン</a>
      <a class="nav-link text-dark" href="{% url 'account:logout' %}" tabindex="-1" aria-disabled="true">ログアウト</a>
    </div>
  </nav>
  <div class="container-fluid">
    <div class="row">
      <div class="col-1">
      </div>
      <div class="col-2">
        <br>
        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
          <a class="nav-link" id="v-pills-home-tab" href="{% url 'article:article' %}" role="tab">Home</a>
          <a class="nav-link active" id="v-pills-profile-tab" href="#v-pills-profile" role="tab">Profile</a>
          <a class="nav-link" id="v-pills-messages-tab" href="#v-pills-messages" role="tab">Messages</a>
          <a class="nav-link" id="v-pills-settings-tab" href="#v-pills-settings" role="tab">Settings</a>
        </div>
      </div>
      <div class="col-5">
        <!-- /.row -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <nav class="nav nav-pills flex-column flex-sm-row">
                <a class="flex-sm-fill text-sm-center nav-link active"
                  href="{% url 'account:following' user_id %}">フォロー中</a>
                <a class="flex-sm-fill text-sm-center nav-link" href="{% url 'account:follower' user_id %}">フォロワー</a>
              </nav>
              <!-- /.card-header -->
              <div class="card-body p-0">
                <table class="table table-hover">
                  <col width="20%">
                  <col width="50%">
                  <col width="30%">
                  <tbody>
                    {% for following_info in following_info_list %}
                    <tr style="cursor: pointer;">
                      <td>
                        {% if following_info.relation_profile.profile_image %}
                        <a href="{% url 'account:profile' following_info.relation_profile.user.id %}" class="text-dark"
                          style="font-weight: bold;">
                          <img class="rounded-circle img-bordered-sm following_profile_image"
                            src="{{following_info.relation_profile.profile_image.url}}" alt="user image"
                            style="width:60px;height:60px;">
                        </a>
                        {% else %}
                        <a href="{% url 'account:profile' following_info.relation_profile.user.id %}" class="text-dark"
                          style="font-weight: bold;">
                          <img class="rounded-circle img-bordered-sm following_profile_image"
                            src="/media/default_profile.jpg" alt="user image" style="width:60px;height:60px;">
                        </a>
                        {% endif %}
                      </td>
                      <td>
                        <a href="{% url 'account:profile' following_info.relation_profile.user.id %}" class="text-dark"
                          style="font-weight: bold;">
                          {{following_info.relation_profile.user.name}}
                        </a>
                        <p class="text-muted">{{following_info.relation_profile.introduction}}</p>
                      </td>
                      <td class="text-center align-middle">
                        {% if following_info.relation_profile.user.id == login_user.id %}
                        {% elif following_info.is_follow == 0 %}
                        <button type="button" class="btn btn-outline-primary float-right un-follow">フォローする</button>
                        {% elif following_info.is_follow == 1 %}
                        <button type="button" class="btn bg-gradient-primary float-right already-follow">フォロー中</button>
                        {% endif %}
                        <input type='hidden' value="{{following_info.relation.id}}"
                          id="{{following_info.relation_profile.user.id}}">
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
        </div>
        <!-- /.row -->
      </div>
      <div class="col-3">
        <br>
        <div class="input-group mb-2">
          <input type="text" class="form-control" placeholder="Find Friends" aria-label="Recipient's username"
            aria-describedby="basic-addon2">
          <div class="input-group-append">
            <span class="input-group-text" id="basic-addon2"><i class="fas fa-search"
                style="font-size: 24px;"></i></span>
          </div>
        </div>
      </div>
      <div class="col-1">
      </div>
    </div>
  </div>
  </div>
</body>

</html>